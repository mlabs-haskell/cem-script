<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="annot"><span class="hs-comment">{- | User-facing utilities for querying and sending Txs
on top of interfaces in `Monads` module
-}</span></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.CEM.OffChain</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Haskell imports</span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">threadDelay</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExceptT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runExceptT</span></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadIO</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadTrans</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Data</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/plutus-ledger-api-1.21.0.0-1b57f518c9186e0f88796bb5ca61ae8aad79286aaddc760c0b547f08904e829b/share/doc/html/src/PlutusLedgerApi.V1.Address.html"><span class="hs-identifier">PlutusLedgerApi.V1.Address</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/plutus-ledger-api-1.21.0.0-1b57f518c9186e0f88796bb5ca61ae8aad79286aaddc760c0b547f08904e829b/share/doc/html/src/PlutusLedgerApi.V1.Address.html#Address"><span class="hs-identifier">Address</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/plutus-ledger-api-1.21.0.0-1b57f518c9186e0f88796bb5ca61ae8aad79286aaddc760c0b547f08904e829b/share/doc/html/src/PlutusLedgerApi.V2.html"><span class="hs-identifier">PlutusLedgerApi.V2</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/plutus-tx-1.21.0.0-3d2b6b90b431fd10c385af250c9cbf5353d9dd2c7b595a24bf8345c705ac5ca0/share/doc/html/src/PlutusTx.IsData.Class.html#UnsafeFromData"><span class="hs-identifier">UnsafeFromData</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/plutus-ledger-api-1.21.0.0-1b57f518c9186e0f88796bb5ca61ae8aad79286aaddc760c0b547f08904e829b/share/doc/html/src/PlutusLedgerApi.V1.Interval.html#always"><span class="hs-identifier">always</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/plutus-tx-1.21.0.0-3d2b6b90b431fd10c385af250c9cbf5353d9dd2c7b595a24bf8345c705ac5ca0/share/doc/html/src/PlutusTx.IsData.Class.html#fromData"><span class="hs-identifier">fromData</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-9ce61ed6f4f6a48753883a4b458503c397451c80e8ace4b49db7a1ba5822eb9f/share/doc/html/src/Cardano.Api.html"><span class="hs-identifier">Cardano.Api</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Address.html#Address"><span class="hs-identifier">Address</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.IO.Base.html#In"><span class="hs-identifier">In</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.IO.Base.html#Out"><span class="hs-identifier">Out</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Query.Expr.html#queryUtxo"><span class="hs-identifier">queryUtxo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Tx.Body.html#txIns"><span class="hs-identifier">txIns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-9ce61ed6f4f6a48753883a4b458503c397451c80e8ace4b49db7a1ba5822eb9f/share/doc/html/src/Cardano.Api.Shelley.html"><span class="hs-identifier">Cardano.Api.Shelley</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Script.html#PlutusScript"><span class="hs-identifier">PlutusScript</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Script.html#ReferenceScript"><span class="hs-identifier">ReferenceScript</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Value.html#toMaryValue"><span class="hs-identifier">toMaryValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.ScriptData.html#toPlutusData"><span class="hs-identifier">toPlutusData</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>
</span><span id="line-32"></span><span class="hs-comment">-- Project imports</span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.CEM.html"><span class="hs-identifier">Cardano.CEM</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.CEM.Monads.html"><span class="hs-identifier">Cardano.CEM.Monads</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.CEM.OnChain.html"><span class="hs-identifier">Cardano.CEM.OnChain</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.OnChain.html#CEMScriptCompiled"><span class="hs-identifier">CEMScriptCompiled</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CEM.OnChain.html#cemScriptAddress"><span class="hs-identifier">cemScriptAddress</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html"><span class="hs-identifier">Cardano.Extras</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/data-spine/doc/html/cem-script/src/Data.Spine.html"><span class="hs-identifier">Data.Spine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/data-spine/doc/html/cem-script/src/Data.Spine.html#HasSpine"><span class="hs-identifier">HasSpine</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/data-spine/doc/html/cem-script/src/Data.Spine.html#getSpine"><span class="hs-identifier">getSpine</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span id="local-6989586621679556992"><span class="annot"><a href="Cardano.CEM.OffChain.html#fromPlutusAddressInMonad"><span class="hs-identifier hs-type">fromPlutusAddressInMonad</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-41"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.Monads.html#MonadBlockchainParams"><span class="hs-identifier hs-type">MonadBlockchainParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679556992"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/plutus-ledger-api-1.21.0.0-1b57f518c9186e0f88796bb5ca61ae8aad79286aaddc760c0b547f08904e829b/share/doc/html/src/PlutusLedgerApi.V1.Address.html#Address"><span class="hs-identifier hs-type">Address</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679556992"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Address.html#AddressInEra"><span class="hs-identifier hs-type">AddressInEra</span></a></span><span> </span><span class="annot"><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#Era"><span class="hs-identifier hs-type">Era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-42"></span><span id="fromPlutusAddressInMonad"><span class="annot"><span class="annottext">fromPlutusAddressInMonad :: forall (m :: * -&gt; *).
MonadBlockchainParams m =&gt;
Address -&gt; m (AddressInEra Era)
</span><a href="Cardano.CEM.OffChain.html#fromPlutusAddressInMonad"><span class="hs-identifier hs-var hs-var">fromPlutusAddressInMonad</span></a></span></span><span> </span><span id="local-6989586621679557269"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679557269"><span class="hs-identifier hs-var">address</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-43"></span><span>  </span><span id="local-6989586621679557270"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679557270"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m NetworkId
forall (m :: * -&gt; *). MonadBlockchainParams m =&gt; m NetworkId
</span><a href="Cardano.CEM.Monads.html#askNetworkId"><span class="hs-identifier hs-var">askNetworkId</span></a></span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><span class="annottext">AddressInEra Era -&gt; m (AddressInEra Era)
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(AddressInEra Era -&gt; m (AddressInEra Era))
-&gt; AddressInEra Era -&gt; m (AddressInEra Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; Address -&gt; AddressInEra Era
</span><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#fromPlutusAddress"><span class="hs-identifier hs-var">fromPlutusAddress</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679557270"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679557269"><span class="hs-identifier hs-var">address</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span id="local-6989586621679557006"><span class="annot"><a href="Cardano.CEM.OffChain.html#checkTxIdExists"><span class="hs-identifier hs-type">checkTxIdExists</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.Monads.html#MonadQueryUtxo"><span class="hs-identifier hs-type">MonadQueryUtxo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557006"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.TxIn.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679557006"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-47"></span><span id="checkTxIdExists"><span class="annot"><span class="annottext">checkTxIdExists :: forall (m :: * -&gt; *). MonadQueryUtxo m =&gt; TxId -&gt; m Bool
</span><a href="Cardano.CEM.OffChain.html#checkTxIdExists"><span class="hs-identifier hs-var hs-var">checkTxIdExists</span></a></span></span><span> </span><span id="local-6989586621679557282"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679557282"><span class="hs-identifier hs-var">txId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-48"></span><span>  </span><span id="local-6989586621679557283"><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679557283"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UtxoQuery -&gt; m (UTxO Era)
forall (m :: * -&gt; *). MonadQueryUtxo m =&gt; UtxoQuery -&gt; m (UTxO Era)
</span><a href="Cardano.CEM.Monads.html#queryUtxo"><span class="hs-identifier hs-var">queryUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">(UtxoQuery -&gt; m (UTxO Era)) -&gt; UtxoQuery -&gt; m (UTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; UtxoQuery
</span><a href="Cardano.CEM.Monads.html#ByTxIns"><span class="hs-identifier hs-var">ByTxIns</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; TxIn
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.TxIn.html#TxIn"><span class="hs-identifier hs-var">TxIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679557282"><span class="hs-identifier hs-var">txId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; TxIx
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.TxIn.html#TxIx"><span class="hs-identifier hs-var">TxIx</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m Bool
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; m Bool) -&gt; Bool -&gt; m Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO Era) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">(Map TxIn (TxOut CtxUTxO Era) -&gt; Bool)
-&gt; Map TxIn (TxOut CtxUTxO Era) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UTxO Era -&gt; Map TxIn (TxOut CtxUTxO Era)
forall era. UTxO era -&gt; Map TxIn (TxOut CtxUTxO era)
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Query.html#unUTxO"><span class="hs-identifier hs-var">unUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679557283"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="annot"><a href="Cardano.CEM.OffChain.html#awaitTx"><span class="hs-identifier hs-type">awaitTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679557021"><span class="annot"><a href="#local-6989586621679557021"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679557021"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CEM.Monads.html#MonadQueryUtxo"><span class="hs-identifier hs-type">MonadQueryUtxo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557021"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.TxIn.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679557021"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span id="awaitTx"><span class="annot"><span class="annottext">awaitTx :: forall (m :: * -&gt; *). (MonadIO m, MonadQueryUtxo m) =&gt; TxId -&gt; m ()
</span><a href="Cardano.CEM.OffChain.html#awaitTx"><span class="hs-identifier hs-var hs-var">awaitTx</span></a></span></span><span> </span><span id="local-6989586621679557310"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679557310"><span class="hs-identifier hs-var">txId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><span class="annottext">Integer -&gt; m ()
</span><a href="#local-6989586621679557311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">5</span></span><span>
</span><span id="line-54"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="#local-6989586621679557311"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679557021"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>    </span><span id="local-6989586621679557311"><span class="annot"><span class="annottext">go :: Integer -&gt; m ()
</span><a href="#local-6989586621679557311"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
forall a. String -&gt; IO a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Tx was not awaited.&quot;</span></span><span> </span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-57"></span><span>    </span><span class="annot"><a href="#local-6989586621679557311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679557313"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679557313"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-58"></span><span>      </span><span id="local-6989586621679557314"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679557314"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; m Bool
forall (m :: * -&gt; *). MonadQueryUtxo m =&gt; TxId -&gt; m Bool
</span><a href="Cardano.CEM.OffChain.html#checkTxIdExists"><span class="hs-identifier hs-var">checkTxIdExists</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679557310"><span class="hs-identifier hs-var">txId</span></a></span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall a. IO a -&gt; m a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><span class="hs-identifier hs-var">threadDelay</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1_000_000</span></span><span>
</span><span id="line-60"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679557314"><span class="hs-identifier hs-var">exists</span></a></span><span>
</span><span id="line-61"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; m ()
</span><a href="#local-6989586621679557311"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; m ()) -&gt; Integer -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679557313"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">data</span><span> </span><span id="CEMAction"><span class="annot"><a href="Cardano.CEM.OffChain.html#CEMAction"><span class="hs-identifier hs-var">CEMAction</span></a></span></span><span> </span><span id="local-6989586621679557315"><span class="annot"><a href="#local-6989586621679557315"><span class="hs-identifier hs-type">script</span></a></span></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="MkCEMAction"><span class="annot"><a href="Cardano.CEM.OffChain.html#MkCEMAction"><span class="hs-identifier hs-var">MkCEMAction</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#CEMParams"><span class="hs-identifier hs-type">CEMParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557315"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557315"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-68"></span><span id="local-6989586621679557321"><span id="local-6989586621679557327"><span id="local-6989586621679557331"><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679557035"><span class="annot"><a href="#local-6989586621679557035"><span class="hs-keyword hs-type">stock</span></a></span></span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#CEMParams"><span class="hs-identifier hs-type">CEMParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557035"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557035"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557035"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.OffChain.html#CEMAction"><span class="hs-identifier hs-type">CEMAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557035"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">data</span><span> </span><span id="SomeCEMAction"><span class="annot"><a href="Cardano.CEM.OffChain.html#SomeCEMAction"><span class="hs-identifier hs-var">SomeCEMAction</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-76"></span><span>  </span><span id="MkSomeCEMAction"><span class="annot"><a href="Cardano.CEM.OffChain.html#MkSomeCEMAction"><span class="hs-identifier hs-var">MkSomeCEMAction</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679557335"><span class="annot"><a href="#local-6989586621679557335"><span class="hs-identifier hs-type">script</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.CEM.OnChain.html#CEMScriptCompiled"><span class="hs-identifier hs-type">CEMScriptCompiled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557335"><span class="hs-identifier hs-type">script</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.OffChain.html#CEMAction"><span class="hs-identifier hs-type">CEMAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557335"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557335"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#Transition"><span class="hs-identifier hs-type">Transition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557335"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#CEMParams"><span class="hs-identifier hs-type">CEMParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557335"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="Cardano.CEM.OffChain.html#CEMAction"><span class="hs-identifier hs-type">CEMAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557335"><span class="hs-identifier hs-type">script</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="Cardano.CEM.OffChain.html#SomeCEMAction"><span class="hs-identifier hs-type">SomeCEMAction</span></a></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679557337"><span id="local-6989586621679557342"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Cardano.CEM.OffChain.html#SomeCEMAction"><span class="hs-identifier hs-type">SomeCEMAction</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-comment">-- TODO: show script name</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">show</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.CEM.OffChain.html#SomeCEMAction"><span class="hs-identifier hs-type">SomeCEMAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-90"></span><span>  </span><span id="local-6989586621679557345"><span class="annot"><span class="annottext">show :: SomeCEMAction -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.OffChain.html#MkSomeCEMAction"><span class="hs-identifier hs-type">MkSomeCEMAction</span></a></span><span> </span><span id="local-6989586621679557352"><span class="annot"><span class="annottext">CEMAction script
</span><a href="#local-6989586621679557352"><span class="hs-identifier hs-var">action</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CEMAction script -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">CEMAction script
</span><a href="#local-6989586621679557352"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-keyword">data</span><span> </span><span id="TxSpec"><span class="annot"><a href="Cardano.CEM.OffChain.html#TxSpec"><span class="hs-identifier hs-var">TxSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MkTxSpec"><span class="annot"><a href="Cardano.CEM.OffChain.html#MkTxSpec"><span class="hs-identifier hs-var">MkTxSpec</span></a></span></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Aactions%3AMkTxSpec"><span class="annot"><span class="annottext">TxSpec -&gt; [SomeCEMAction]
</span><a href="Cardano.CEM.OffChain.html#%24sel%3Aactions%3AMkTxSpec"><span class="hs-identifier hs-var hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Cardano.CEM.OffChain.html#SomeCEMAction"><span class="hs-identifier hs-type">SomeCEMAction</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AspecSigner%3AMkTxSpec"><span class="annot"><span class="annottext">TxSpec -&gt; SigningKey PaymentKey
</span><a href="Cardano.CEM.OffChain.html#%24sel%3AspecSigner%3AMkTxSpec"><span class="hs-identifier hs-var hs-var">specSigner</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Keys.Class.html#SigningKey"><span class="hs-identifier hs-type">SigningKey</span></a></span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Keys.Shelley.html#PaymentKey"><span class="hs-identifier hs-type">PaymentKey</span></a></span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679557357"><span id="local-6989586621679557365"><span id="local-6989586621679557369"><span class="annot"><span class="annottext">Int -&gt; TxSpec -&gt; ShowS
[TxSpec] -&gt; ShowS
TxSpec -&gt; String
(Int -&gt; TxSpec -&gt; ShowS)
-&gt; (TxSpec -&gt; String) -&gt; ([TxSpec] -&gt; ShowS) -&gt; Show TxSpec
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; TxSpec -&gt; ShowS
showsPrec :: Int -&gt; TxSpec -&gt; ShowS
$cshow :: TxSpec -&gt; String
show :: TxSpec -&gt; String
$cshowList :: [TxSpec] -&gt; ShowS
showList :: [TxSpec] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span class="annot"><span class="hs-comment">-- | Error occurred while trying to execute CEMScript transition</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">data</span><span> </span><span id="TransitionError"><span class="annot"><a href="Cardano.CEM.OffChain.html#TransitionError"><span class="hs-identifier hs-var">TransitionError</span></a></span></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="StateMachineError"><span class="annot"><a href="Cardano.CEM.OffChain.html#StateMachineError"><span class="hs-identifier hs-var">StateMachineError</span></a></span></span><span>
</span><span id="line-101"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AerrorMessage%3AStateMachineError"><span class="annot"><span class="annottext">TransitionError -&gt; String
</span><a href="Cardano.CEM.OffChain.html#%24sel%3AerrorMessage%3AStateMachineError"><span class="hs-identifier hs-var hs-var">errorMessage</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-102"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MissingTransitionInput"><span class="annot"><a href="Cardano.CEM.OffChain.html#MissingTransitionInput"><span class="hs-identifier hs-var">MissingTransitionInput</span></a></span></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679557375"><span id="local-6989586621679557380"><span id="local-6989586621679557384"><span class="annot"><span class="annottext">Int -&gt; TransitionError -&gt; ShowS
[TransitionError] -&gt; ShowS
TransitionError -&gt; String
(Int -&gt; TransitionError -&gt; ShowS)
-&gt; (TransitionError -&gt; String)
-&gt; ([TransitionError] -&gt; ShowS)
-&gt; Show TransitionError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; TransitionError -&gt; ShowS
showsPrec :: Int -&gt; TransitionError -&gt; ShowS
$cshow :: TransitionError -&gt; String
show :: TransitionError -&gt; String
$cshowList :: [TransitionError] -&gt; ShowS
showList :: [TransitionError] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679557388"><span id="local-6989586621679557393"><span class="annot"><span class="annottext">TransitionError -&gt; TransitionError -&gt; Bool
(TransitionError -&gt; TransitionError -&gt; Bool)
-&gt; (TransitionError -&gt; TransitionError -&gt; Bool)
-&gt; Eq TransitionError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: TransitionError -&gt; TransitionError -&gt; Bool
== :: TransitionError -&gt; TransitionError -&gt; Bool
$c/= :: TransitionError -&gt; TransitionError -&gt; Bool
/= :: TransitionError -&gt; TransitionError -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span class="hs-keyword">data</span><span> </span><span id="TxResolutionError"><span class="annot"><a href="Cardano.CEM.OffChain.html#TxResolutionError"><span class="hs-identifier hs-var">TxResolutionError</span></a></span></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="TxSpecIsIncorrect"><span class="annot"><a href="Cardano.CEM.OffChain.html#TxSpecIsIncorrect"><span class="hs-identifier hs-var">TxSpecIsIncorrect</span></a></span></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="MkTransitionError"><span class="annot"><a href="Cardano.CEM.OffChain.html#MkTransitionError"><span class="hs-identifier hs-var">MkTransitionError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.CEM.OffChain.html#SomeCEMAction"><span class="hs-identifier hs-type">SomeCEMAction</span></a></span><span> </span><span class="annot"><a href="Cardano.CEM.OffChain.html#TransitionError"><span class="hs-identifier hs-type">TransitionError</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="UnhandledSubmittingError"><span class="annot"><a href="Cardano.CEM.OffChain.html#UnhandledSubmittingError"><span class="hs-identifier hs-var">UnhandledSubmittingError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.CEM.Monads.html#TxSubmittingError"><span class="hs-identifier hs-type">TxSubmittingError</span></a></span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679557402"><span id="local-6989586621679557410"><span id="local-6989586621679557414"><span class="annot"><span class="annottext">Int -&gt; TxResolutionError -&gt; ShowS
[TxResolutionError] -&gt; ShowS
TxResolutionError -&gt; String
(Int -&gt; TxResolutionError -&gt; ShowS)
-&gt; (TxResolutionError -&gt; String)
-&gt; ([TxResolutionError] -&gt; ShowS)
-&gt; Show TxResolutionError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; TxResolutionError -&gt; ShowS
showsPrec :: Int -&gt; TxResolutionError -&gt; ShowS
$cshow :: TxResolutionError -&gt; String
show :: TxResolutionError -&gt; String
$cshowList :: [TxResolutionError] -&gt; ShowS
showList :: [TxResolutionError] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span id="local-6989586621679557048"><span id="local-6989586621679557049"><span id="local-6989586621679557050"><span class="annot"><a href="Cardano.CEM.OffChain.html#failLeft"><span class="hs-identifier hs-type">failLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679557048"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679557049"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679557049"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557050"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679557048"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557050"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-113"></span><span id="failLeft"><span class="annot"><span class="annottext">failLeft :: forall (m :: * -&gt; *) s a.
(MonadFail m, Show s) =&gt;
Either s a -&gt; m a
</span><a href="Cardano.CEM.OffChain.html#failLeft"><span class="hs-identifier hs-var hs-var">failLeft</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679557423"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679557423"><span class="hs-identifier hs-var">errorMsg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m a
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m a) -&gt; String -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679557423"><span class="hs-identifier hs-var">errorMsg</span></a></span><span>
</span><span id="line-114"></span><span class="annot"><a href="Cardano.CEM.OffChain.html#failLeft"><span class="hs-identifier hs-var">failLeft</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679557424"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679557424"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679557424"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- TODO: use regular CEMScript</span><span>
</span><span id="line-117"></span><span id="local-6989586621679557054"><span id="local-6989586621679557055"><span class="annot"><a href="Cardano.CEM.OffChain.html#cemTxOutDatum"><span class="hs-identifier hs-type">cemTxOutDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.OnChain.html#CEMScriptCompiled"><span class="hs-identifier hs-type">CEMScriptCompiled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557054"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557055"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#Era"><span class="hs-identifier hs-type">Era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#CEMScriptDatum"><span class="hs-identifier hs-type">CEMScriptDatum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557054"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-118"></span><span id="cemTxOutDatum"><span class="annot"><span class="annottext">cemTxOutDatum :: forall script ctx.
CEMScriptCompiled script =&gt;
TxOut ctx Era -&gt; Maybe (CEMScriptDatum script)
</span><a href="Cardano.CEM.OffChain.html#cemTxOutDatum"><span class="hs-identifier hs-var hs-var">cemTxOutDatum</span></a></span></span><span> </span><span id="local-6989586621679557443"><span class="annot"><span class="annottext">TxOut ctx Era
</span><a href="#local-6989586621679557443"><span class="hs-identifier hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><span class="annottext">Data
-&gt; Maybe (StageParams (Stage script), Params script, State script)
forall a. FromData a =&gt; Data -&gt; Maybe a
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/plutus-tx-1.21.0.0-3d2b6b90b431fd10c385af250c9cbf5353d9dd2c7b595a24bf8345c705ac5ca0/share/doc/html/src/PlutusTx.IsData.Class.html#fromData"><span class="hs-identifier hs-var">fromData</span></a></span><span> </span><span class="annot"><span class="annottext">(Data
 -&gt; Maybe (StageParams (Stage script), Params script, State script))
-&gt; Maybe Data
-&gt; Maybe (StageParams (Stage script), Params script, State script)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ScriptData -&gt; Data
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.ScriptData.html#toPlutusData"><span class="hs-identifier hs-var">toPlutusData</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptData -&gt; Data)
-&gt; (HashableScriptData -&gt; ScriptData) -&gt; HashableScriptData -&gt; Data
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashableScriptData -&gt; ScriptData
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.ScriptData.html#getScriptData"><span class="hs-identifier hs-var">getScriptData</span></a></span><span> </span><span class="annot"><span class="annottext">(HashableScriptData -&gt; Data)
-&gt; Maybe HashableScriptData -&gt; Maybe Data
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxOut ctx Era -&gt; Maybe HashableScriptData
forall ctx. TxOut ctx Era -&gt; Maybe HashableScriptData
</span><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#mTxOutDatum"><span class="hs-identifier hs-var">mTxOutDatum</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut ctx Era
</span><a href="#local-6989586621679557443"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span id="local-6989586621679557086"><span id="local-6989586621679557087"><span class="annot"><a href="Cardano.CEM.OffChain.html#cemTxOutState"><span class="hs-identifier hs-type">cemTxOutState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.OnChain.html#CEMScriptCompiled"><span class="hs-identifier hs-type">CEMScriptCompiled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557086"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557087"><span class="hs-identifier hs-type">ctx</span></a></span><span> </span><span class="annot"><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#Era"><span class="hs-identifier hs-type">Era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557086"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-122"></span><span id="cemTxOutState"><span class="annot"><span class="annottext">cemTxOutState :: forall script ctx.
CEMScriptCompiled script =&gt;
TxOut ctx Era -&gt; Maybe (State script)
</span><a href="Cardano.CEM.OffChain.html#cemTxOutState"><span class="hs-identifier hs-var hs-var">cemTxOutState</span></a></span></span><span> </span><span id="local-6989586621679557452"><span class="annot"><span class="annottext">TxOut ctx Era
</span><a href="#local-6989586621679557452"><span class="hs-identifier hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679557453"><span class="annot"><span class="annottext">getState :: (a, b, c) -&gt; c
</span><a href="#local-6989586621679557453"><span class="hs-identifier hs-var hs-var">getState</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679557454"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679557454"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679557454"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-125"></span><span>   </span><span class="hs-keyword">in</span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="annottext">(StageParams (Stage script), Params script, State script)
-&gt; State script
forall {a} {b} {c}. (a, b, c) -&gt; c
</span><a href="#local-6989586621679557453"><span class="hs-identifier hs-var">getState</span></a></span><span> </span><span class="annot"><span class="annottext">((StageParams (Stage script), Params script, State script)
 -&gt; State script)
-&gt; Maybe (StageParams (Stage script), Params script, State script)
-&gt; Maybe (State script)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxOut ctx Era
-&gt; Maybe (StageParams (Stage script), Params script, State script)
forall script ctx.
CEMScriptCompiled script =&gt;
TxOut ctx Era -&gt; Maybe (CEMScriptDatum script)
</span><a href="Cardano.CEM.OffChain.html#cemTxOutDatum"><span class="hs-identifier hs-var">cemTxOutDatum</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut ctx Era
</span><a href="#local-6989586621679557452"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><a href="Cardano.CEM.OffChain.html#queryScriptTxInOut"><span class="hs-identifier hs-type">queryScriptTxInOut</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679557093"><span class="annot"><a href="#local-6989586621679557093"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679557094"><span class="annot"><a href="#local-6989586621679557094"><span class="hs-identifier hs-type">script</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.CEM.Monads.html#MonadQueryUtxo"><span class="hs-identifier hs-type">MonadQueryUtxo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557093"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-131"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CEM.OnChain.html#CEMScriptCompiled"><span class="hs-identifier hs-type">CEMScriptCompiled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557094"><span class="hs-identifier hs-type">script</span></a></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#CEMParams"><span class="hs-identifier hs-type">CEMParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557094"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="Cardano.CEM.html#CEMParams"><span class="hs-identifier hs-type">CEMParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557094"><span class="hs-identifier hs-type">script</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="#local-6989586621679557093"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Tx.Body.html#CtxUTxO"><span class="hs-identifier hs-type">CtxUTxO</span></a></span><span> </span><span class="annot"><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#Era"><span class="hs-identifier hs-type">Era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span id="queryScriptTxInOut"><span class="annot"><span class="annottext">queryScriptTxInOut :: forall (m :: * -&gt; *) script.
(MonadQueryUtxo m, CEMScriptCompiled script,
 Eq (CEMParams script)) =&gt;
CEMParams script -&gt; m (Maybe (TxIn, TxOut CtxUTxO Era))
</span><a href="Cardano.CEM.OffChain.html#queryScriptTxInOut"><span class="hs-identifier hs-var hs-var">queryScriptTxInOut</span></a></span></span><span> </span><span id="local-6989586621679557470"><span class="annot"><span class="annottext">CEMParams script
</span><a href="#local-6989586621679557470"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-137"></span><span>  </span><span id="local-6989586621679557471"><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679557471"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UtxoQuery -&gt; m (UTxO Era)
forall (m :: * -&gt; *). MonadQueryUtxo m =&gt; UtxoQuery -&gt; m (UTxO Era)
</span><a href="Cardano.CEM.Monads.html#queryUtxo"><span class="hs-identifier hs-var">queryUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">(UtxoQuery -&gt; m (UTxO Era)) -&gt; UtxoQuery -&gt; m (UTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Address] -&gt; UtxoQuery
</span><a href="Cardano.CEM.Monads.html#ByAddresses"><span class="hs-identifier hs-var">ByAddresses</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679557473"><span class="hs-identifier hs-var">scriptAddress</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679557474"><span class="annot"><span class="annottext">mScriptTxIn :: Maybe (TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679557474"><span class="hs-identifier hs-var hs-var">mScriptTxIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO Era) -&gt; [(TxIn, TxOut CtxUTxO Era)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.assocs</span></span><span> </span><span class="annot"><span class="annottext">(Map TxIn (TxOut CtxUTxO Era) -&gt; [(TxIn, TxOut CtxUTxO Era)])
-&gt; Map TxIn (TxOut CtxUTxO Era) -&gt; [(TxIn, TxOut CtxUTxO Era)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UTxO Era -&gt; Map TxIn (TxOut CtxUTxO Era)
forall era. UTxO era -&gt; Map TxIn (TxOut CtxUTxO era)
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Query.html#unUTxO"><span class="hs-identifier hs-var">unUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679557471"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-140"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TxIn, TxOut CtxUTxO Era)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-141"></span><span>          </span><span id="local-6989586621679557476"><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO Era)]
</span><a href="#local-6989586621679557476"><span class="hs-identifier hs-var">pairs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO Era) -&gt; Bool)
-&gt; [(TxIn, TxOut CtxUTxO Era)] -&gt; Maybe (TxIn, TxOut CtxUTxO Era)
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era) -&gt; Bool
</span><a href="#local-6989586621679557477"><span class="hs-identifier hs-var">hasSameParams</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut CtxUTxO Era)]
</span><a href="#local-6989586621679557476"><span class="hs-identifier hs-var">pairs</span></a></span><span>
</span><span id="line-142"></span><span>      </span><span id="local-6989586621679557477"><span class="annot"><span class="annottext">hasSameParams :: (TxIn, TxOut CtxUTxO Era) -&gt; Bool
</span><a href="#local-6989586621679557477"><span class="hs-identifier hs-var hs-var">hasSameParams</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679557478"><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679557478"><span class="hs-identifier hs-var">txOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era -&gt; Maybe (CEMScriptDatum script)
forall script ctx.
CEMScriptCompiled script =&gt;
TxOut ctx Era -&gt; Maybe (CEMScriptDatum script)
</span><a href="Cardano.CEM.OffChain.html#cemTxOutDatum"><span class="hs-identifier hs-var">cemTxOutDatum</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679557478"><span class="hs-identifier hs-var">txOut</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-144"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679557479"><span class="annot"><span class="annottext">StageParams (Stage script)
</span><a href="#local-6989586621679557479"><span class="hs-identifier hs-var">p1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679557480"><span class="annot"><span class="annottext">Params script
</span><a href="#local-6989586621679557480"><span class="hs-identifier hs-var">p2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State script
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CEMParams script
</span><a href="#local-6989586621679557470"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">CEMParams script -&gt; CEMParams script -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Params script -&gt; StageParams (Stage script) -&gt; CEMParams script
forall script.
Params script -&gt; StageParams (Stage script) -&gt; CEMParams script
</span><a href="Cardano.CEM.html#MkCEMParams"><span class="hs-identifier hs-var">MkCEMParams</span></a></span><span> </span><span class="annot"><span class="annottext">Params script
</span><a href="#local-6989586621679557480"><span class="hs-identifier hs-var">p2</span></a></span><span> </span><span class="annot"><span class="annottext">StageParams (Stage script)
</span><a href="#local-6989586621679557479"><span class="hs-identifier hs-var">p1</span></a></span><span>
</span><span id="line-145"></span><span>          </span><span class="annot"><span class="annottext">Maybe (CEMScriptDatum script)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- May happen in case of changed Datum encoding</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><span class="annottext">Maybe (TxIn, TxOut CtxUTxO Era)
-&gt; m (Maybe (TxIn, TxOut CtxUTxO Era))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679557474"><span class="hs-identifier hs-var">mScriptTxIn</span></a></span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-148"></span><span>    </span><span id="local-6989586621679557473"><span class="annot"><span class="annottext">scriptAddress :: Address
</span><a href="#local-6989586621679557473"><span class="hs-identifier hs-var hs-var">scriptAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy script -&gt; Address
forall script. CEMScriptCompiled script =&gt; Proxy script -&gt; Address
</span><a href="Cardano.CEM.OnChain.html#cemScriptAddress"><span class="hs-identifier hs-var">cemScriptAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy script
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679557094"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="annot"><a href="Cardano.CEM.OffChain.html#queryScriptState"><span class="hs-identifier hs-type">queryScriptState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679557106"><span class="annot"><a href="#local-6989586621679557106"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679557107"><span class="annot"><a href="#local-6989586621679557107"><span class="hs-identifier hs-type">script</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-152"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.CEM.Monads.html#MonadQueryUtxo"><span class="hs-identifier hs-type">MonadQueryUtxo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557106"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CEM.OnChain.html#CEMScriptCompiled"><span class="hs-identifier hs-type">CEMScriptCompiled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557107"><span class="hs-identifier hs-type">script</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#CEMParams"><span class="hs-identifier hs-type">CEMParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557107"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="Cardano.CEM.html#CEMParams"><span class="hs-identifier hs-type">CEMParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557107"><span class="hs-identifier hs-type">script</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>  </span><span class="annot"><a href="#local-6989586621679557106"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557107"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span id="queryScriptState"><span class="annot"><span class="annottext">queryScriptState :: forall (m :: * -&gt; *) script.
(MonadQueryUtxo m, CEMScriptCompiled script,
 Eq (CEMParams script)) =&gt;
CEMParams script -&gt; m (Maybe (State script))
</span><a href="Cardano.CEM.OffChain.html#queryScriptState"><span class="hs-identifier hs-var hs-var">queryScriptState</span></a></span></span><span> </span><span id="local-6989586621679557497"><span class="annot"><span class="annottext">CEMParams script
</span><a href="#local-6989586621679557497"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621679557498"><span class="annot"><span class="annottext">Maybe (TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679557498"><span class="hs-identifier hs-var">mTxInOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CEMParams script -&gt; m (Maybe (TxIn, TxOut CtxUTxO Era))
forall (m :: * -&gt; *) script.
(MonadQueryUtxo m, CEMScriptCompiled script,
 Eq (CEMParams script)) =&gt;
CEMParams script -&gt; m (Maybe (TxIn, TxOut CtxUTxO Era))
</span><a href="Cardano.CEM.OffChain.html#queryScriptTxInOut"><span class="hs-identifier hs-var">queryScriptTxInOut</span></a></span><span> </span><span class="annot"><span class="annottext">CEMParams script
</span><a href="#local-6989586621679557497"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="annottext">Maybe (State script) -&gt; m (Maybe (State script))
forall a. a -&gt; m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut CtxUTxO Era -&gt; Maybe (State script)
forall script ctx.
CEMScriptCompiled script =&gt;
TxOut ctx Era -&gt; Maybe (State script)
</span><a href="Cardano.CEM.OffChain.html#cemTxOutState"><span class="hs-identifier hs-var">cemTxOutState</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO Era -&gt; Maybe (State script))
-&gt; ((TxIn, TxOut CtxUTxO Era) -&gt; TxOut CtxUTxO Era)
-&gt; (TxIn, TxOut CtxUTxO Era)
-&gt; Maybe (State script)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era) -&gt; TxOut CtxUTxO Era
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO Era) -&gt; Maybe (State script))
-&gt; Maybe (TxIn, TxOut CtxUTxO Era) -&gt; Maybe (State script)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679557498"><span class="hs-identifier hs-var">mTxInOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="annot"><a href="Cardano.CEM.OffChain.html#resolveAction"><span class="hs-identifier hs-type">resolveAction</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679557115"><span class="annot"><a href="#local-6989586621679557115"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.Monads.html#MonadQueryUtxo"><span class="hs-identifier hs-type">MonadQueryUtxo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557115"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CEM.Monads.html#MonadSubmitTx"><span class="hs-identifier hs-type">MonadSubmitTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557115"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><a href="Cardano.CEM.OffChain.html#SomeCEMAction"><span class="hs-identifier hs-type">SomeCEMAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><a href="#local-6989586621679557115"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Cardano.CEM.OffChain.html#TxResolutionError"><span class="hs-identifier hs-type">TxResolutionError</span></a></span><span> </span><span class="annot"><a href="Cardano.CEM.Monads.html#ResolvedTx"><span class="hs-identifier hs-type">ResolvedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span id="resolveAction"><span class="annot"><span class="annottext">resolveAction :: forall (m :: * -&gt; *).
(MonadQueryUtxo m, MonadSubmitTx m) =&gt;
SomeCEMAction -&gt; m (Either TxResolutionError ResolvedTx)
</span><a href="Cardano.CEM.OffChain.html#resolveAction"><span class="hs-identifier hs-var hs-var">resolveAction</span></a></span></span><span>
</span><span id="line-168"></span><span>  </span><span id="local-6989586621679557511"><span class="annot"><span class="annottext">someAction :: SomeCEMAction
</span><a href="#local-6989586621679557511"><span class="hs-identifier hs-var">someAction</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.OffChain.html#MkSomeCEMAction"><span class="hs-identifier hs-type">MkSomeCEMAction</span></a></span><span> </span><span class="hs-glyph">@</span><span id="local-6989586621679557599"><span class="annot"><a href="#local-6989586621679557599"><span class="hs-identifier hs-type hs-type">script</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.OffChain.html#MkCEMAction"><span class="hs-identifier hs-type">MkCEMAction</span></a></span><span> </span><span id="local-6989586621679557600"><span class="annot"><span class="annottext">CEMParams script
</span><a href="#local-6989586621679557600"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679557601"><span class="annot"><span class="annottext">Transition script
</span><a href="#local-6989586621679557601"><span class="hs-identifier hs-var">transition</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-comment">-- Add script TxIn</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><span class="annottext">ExceptT TxResolutionError m ResolvedTx
-&gt; m (Either TxResolutionError ResolvedTx)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT TxResolutionError m ResolvedTx
 -&gt; m (Either TxResolutionError ResolvedTx))
-&gt; ExceptT TxResolutionError m ResolvedTx
-&gt; m (Either TxResolutionError ResolvedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>      </span><span id="local-6989586621679557602"><span class="annot"><span class="annottext">Maybe (TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679557602"><span class="hs-identifier hs-var">mScriptTxIn'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Maybe (TxIn, TxOut CtxUTxO Era))
-&gt; ExceptT TxResolutionError m (Maybe (TxIn, TxOut CtxUTxO Era))
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT TxResolutionError m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (Maybe (TxIn, TxOut CtxUTxO Era))
 -&gt; ExceptT TxResolutionError m (Maybe (TxIn, TxOut CtxUTxO Era)))
-&gt; m (Maybe (TxIn, TxOut CtxUTxO Era))
-&gt; ExceptT TxResolutionError m (Maybe (TxIn, TxOut CtxUTxO Era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CEMParams script -&gt; m (Maybe (TxIn, TxOut CtxUTxO Era))
forall (m :: * -&gt; *) script.
(MonadQueryUtxo m, CEMScriptCompiled script,
 Eq (CEMParams script)) =&gt;
CEMParams script -&gt; m (Maybe (TxIn, TxOut CtxUTxO Era))
</span><a href="Cardano.CEM.OffChain.html#queryScriptTxInOut"><span class="hs-identifier hs-var">queryScriptTxInOut</span></a></span><span> </span><span class="annot"><span class="annottext">CEMParams script
</span><a href="#local-6989586621679557600"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-175"></span><span>        </span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-176"></span><span>        </span><span id="local-6989586621679557604"><span class="annot"><span class="annottext">mScriptTxIn :: Maybe (TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679557604"><span class="hs-identifier hs-var hs-var">mScriptTxIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Proxy script
-&gt; Map
     (Spine (Transition script))
     (Stage script, Maybe (Spine (State script)),
      Maybe (Spine (State script)))
forall script.
CEMScript script =&gt;
Proxy script
-&gt; Map
     (Spine (Transition script))
     (Stage script, Maybe (Spine (State script)),
      Maybe (Spine (State script)))
</span><a href="Cardano.CEM.html#transitionStage"><span class="hs-identifier hs-var">transitionStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy script
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679557599"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map
  (Spine (Transition script))
  (Stage script, Maybe (Spine (State script)),
   Maybe (Spine (State script)))
-&gt; Spine (Transition script)
-&gt; (Stage script, Maybe (Spine (State script)),
    Maybe (Spine (State script)))
forall k a. Ord k =&gt; Map k a -&gt; k -&gt; a
</span><span class="hs-operator hs-var">Map.!</span></span><span> </span><span class="annot"><span class="annottext">Transition script -&gt; Spine (Transition script)
forall sop. HasSpine sop =&gt; sop -&gt; Spine sop
</span><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/data-spine/doc/html/cem-script/src/Data.Spine.html#getSpine"><span class="hs-identifier hs-var">getSpine</span></a></span><span> </span><span class="annot"><span class="annottext">Transition script
</span><a href="#local-6989586621679557601"><span class="hs-identifier hs-var">transition</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-177"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stage script
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Spine (State script))
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Spine (State script))
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TxIn, TxOut CtxUTxO Era)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-178"></span><span>          </span><span class="annot"><span class="annottext">(Stage script, Maybe (Spine (State script)),
 Maybe (Spine (State script)))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679557602"><span class="hs-identifier hs-var">mScriptTxIn'</span></a></span><span>
</span><span id="line-179"></span><span>        </span><span id="local-6989586621679557607"><span class="annot"><span class="annottext">mState :: Maybe (State script)
</span><a href="#local-6989586621679557607"><span class="hs-identifier hs-var hs-var">mState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era -&gt; Maybe (State script)
forall script ctx.
CEMScriptCompiled script =&gt;
TxOut ctx Era -&gt; Maybe (State script)
</span><a href="Cardano.CEM.OffChain.html#cemTxOutState"><span class="hs-identifier hs-var">cemTxOutState</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut CtxUTxO Era -&gt; Maybe (State script))
-&gt; Maybe (TxOut CtxUTxO Era) -&gt; Maybe (State script)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO Era) -&gt; TxOut CtxUTxO Era
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO Era) -&gt; TxOut CtxUTxO Era)
-&gt; Maybe (TxIn, TxOut CtxUTxO Era) -&gt; Maybe (TxOut CtxUTxO Era)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679557604"><span class="hs-identifier hs-var">mScriptTxIn</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span id="local-6989586621679557608"><span class="annot"><span class="annottext">witnesedScriptTxIns :: [(TxIn, TxInWitness)]
</span><a href="#local-6989586621679557608"><span class="hs-identifier hs-var hs-var">witnesedScriptTxIns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-181"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TxIn, TxOut CtxUTxO Era)
</span><a href="#local-6989586621679557604"><span class="hs-identifier hs-var">mScriptTxIn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-182"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679557609"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679557609"><span class="hs-identifier hs-var">txIn</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-183"></span><span>              </span><span class="hs-keyword">let</span><span>
</span><span id="line-184"></span><span>                </span><span id="local-6989586621679557610"><span class="annot"><span class="annottext">scriptWitness :: TxInWitness
</span><a href="#local-6989586621679557610"><span class="hs-identifier hs-var hs-var">scriptWitness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-185"></span><span>                  </span><span class="annot"><span class="annottext">PlutusScript PlutusLang -&gt; Transition script -&gt; TxInWitness
forall a. ToData a =&gt; PlutusScript PlutusLang -&gt; a -&gt; TxInWitness
</span><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#mkInlinedDatumScriptWitness"><span class="hs-identifier hs-var">mkInlinedDatumScriptWitness</span></a></span><span>
</span><span id="line-186"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall lang. ShortByteString -&gt; PlutusScript lang
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Script.html#PlutusScriptSerialised"><span class="hs-identifier hs-var">PlutusScriptSerialised</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#PlutusLang"><span class="hs-identifier hs-type">PlutusLang</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679557613"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>                    </span><span class="annot"><span class="annottext">Transition script
</span><a href="#local-6989586621679557601"><span class="hs-identifier hs-var">transition</span></a></span><span>
</span><span id="line-188"></span><span>               </span><span class="hs-keyword">in</span><span>
</span><span id="line-189"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679557609"><span class="hs-identifier hs-var">txIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxInWitness
</span><a href="#local-6989586621679557610"><span class="hs-identifier hs-var">scriptWitness</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-190"></span><span>            </span><span class="annot"><span class="annottext">Maybe (TxIn, TxOut CtxUTxO Era)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>      </span><span id="local-6989586621679557614"><span class="annot"><span class="annottext">TransitionSpec script
</span><a href="#local-6989586621679557614"><span class="hs-identifier hs-var">scriptTransition</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Params script
-&gt; Maybe (State script)
-&gt; Transition script
-&gt; Either BuiltinString (TransitionSpec script)
forall script.
CEMScript script =&gt;
Params script
-&gt; Maybe (State script)
-&gt; Transition script
-&gt; Either BuiltinString (TransitionSpec script)
</span><a href="Cardano.CEM.html#transitionSpec"><span class="hs-identifier hs-var">transitionSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CEMParams script -&gt; Params script
forall script. CEMParams script -&gt; Params script
</span><a href="Cardano.CEM.html#%24sel%3AscriptParams%3AMkCEMParams"><span class="hs-identifier hs-var">scriptParams</span></a></span><span> </span><span class="annot"><span class="annottext">CEMParams script
</span><a href="#local-6989586621679557600"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (State script)
</span><a href="#local-6989586621679557607"><span class="hs-identifier hs-var">mState</span></a></span><span> </span><span class="annot"><span class="annottext">Transition script
</span><a href="#local-6989586621679557601"><span class="hs-identifier hs-var">transition</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-193"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679557617"><span class="annot"><span class="annottext">BuiltinString
</span><a href="#local-6989586621679557617"><span class="hs-identifier hs-var">errorMessage</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-194"></span><span>          </span><span class="annot"><span class="annottext">TxResolutionError
-&gt; ExceptT TxResolutionError m (TransitionSpec script)
forall a. TxResolutionError -&gt; ExceptT TxResolutionError m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(TxResolutionError
 -&gt; ExceptT TxResolutionError m (TransitionSpec script))
-&gt; TxResolutionError
-&gt; ExceptT TxResolutionError m (TransitionSpec script)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-195"></span><span>            </span><span class="annot"><span class="annottext">SomeCEMAction -&gt; TransitionError -&gt; TxResolutionError
</span><a href="Cardano.CEM.OffChain.html#MkTransitionError"><span class="hs-identifier hs-var">MkTransitionError</span></a></span><span> </span><span class="annot"><span class="annottext">SomeCEMAction
</span><a href="#local-6989586621679557511"><span class="hs-identifier hs-var">someAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TransitionError
</span><a href="Cardano.CEM.OffChain.html#StateMachineError"><span class="hs-identifier hs-var">StateMachineError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TransitionError) -&gt; String -&gt; TransitionError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><a href="#local-6989586621679557617"><span class="hs-identifier hs-var">errorMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679557619"><span class="annot"><span class="annottext">TransitionSpec script
</span><a href="#local-6989586621679557619"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TransitionSpec script
-&gt; ExceptT TxResolutionError m (TransitionSpec script)
forall a. a -&gt; ExceptT TxResolutionError m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">TransitionSpec script
</span><a href="#local-6989586621679557619"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>      </span><span class="hs-comment">-- Coin-select</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>      </span><span class="hs-keyword">let</span><span>
</span><span id="line-201"></span><span>        </span><span id="local-6989586621679557620"><span class="annot"><span class="annottext">byKind :: TxFanKind -&gt; [TxFanConstraint script]
</span><a href="#local-6989586621679557620"><span class="hs-identifier hs-var hs-var">byKind</span></a></span></span><span> </span><span id="local-6989586621679557621"><span class="annot"><span class="annottext">TxFanKind
</span><a href="#local-6989586621679557621"><span class="hs-identifier hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-202"></span><span>          </span><span class="annot"><span class="annottext">(TxFanConstraint script -&gt; Bool)
-&gt; [TxFanConstraint script] -&gt; [TxFanConstraint script]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679557622"><span class="annot"><span class="annottext">TxFanConstraint script
</span><a href="#local-6989586621679557622"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxFanConstraint script -&gt; TxFanKind
forall script. TxFanConstraint script -&gt; TxFanKind
</span><a href="Cardano.CEM.html#%24sel%3AtxFanCKind%3AMkTxFanC"><span class="hs-identifier hs-var">txFanCKind</span></a></span><span> </span><span class="annot"><span class="annottext">TxFanConstraint script
</span><a href="#local-6989586621679557622"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TxFanKind -&gt; TxFanKind -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TxFanKind
</span><a href="#local-6989586621679557621"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TxFanConstraint script] -&gt; [TxFanConstraint script])
-&gt; [TxFanConstraint script] -&gt; [TxFanConstraint script]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-203"></span><span>            </span><span class="annot"><span class="annottext">TransitionSpec script -&gt; [TxFanConstraint script]
forall script. TransitionSpec script -&gt; [TxFanConstraint script]
</span><a href="Cardano.CEM.html#%24sel%3Aconstraints%3AMkTransitionSpec"><span class="hs-identifier hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionSpec script
</span><a href="#local-6989586621679557614"><span class="hs-identifier hs-var">scriptTransition</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>      </span><span id="local-6989586621679557625"><span class="annot"><span class="annottext">[((TxIn, TxInWitness), TxOut CtxUTxO Era)]
</span><a href="#local-6989586621679557625"><span class="hs-identifier hs-var">txInsPairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[((TxIn, TxInWitness), TxOut CtxUTxO Era)]]
-&gt; [((TxIn, TxInWitness), TxOut CtxUTxO Era)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[((TxIn, TxInWitness), TxOut CtxUTxO Era)]]
 -&gt; [((TxIn, TxInWitness), TxOut CtxUTxO Era)])
-&gt; ExceptT
     TxResolutionError m [[((TxIn, TxInWitness), TxOut CtxUTxO Era)]]
-&gt; ExceptT
     TxResolutionError m [((TxIn, TxInWitness), TxOut CtxUTxO Era)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TxFanConstraint script
 -&gt; ExceptT
      TxResolutionError m [((TxIn, TxInWitness), TxOut CtxUTxO Era)])
-&gt; [TxFanConstraint script]
-&gt; ExceptT
     TxResolutionError m [[((TxIn, TxInWitness), TxOut CtxUTxO Era)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TxFanConstraint script
-&gt; ExceptT
     TxResolutionError m [((TxIn, TxInWitness), TxOut CtxUTxO Era)]
</span><a href="#local-6989586621679557628"><span class="hs-identifier hs-var">resolveTxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxFanKind -&gt; [TxFanConstraint script]
</span><a href="#local-6989586621679557620"><span class="hs-identifier hs-var">byKind</span></a></span><span> </span><span class="annot"><span class="annottext">TxFanKind
</span><a href="Cardano.CEM.html#In"><span class="hs-identifier hs-var">In</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>      </span><span id="local-6989586621679557630"><span class="annot"><span class="annottext">[TxOut CtxTx Era]
</span><a href="#local-6989586621679557630"><span class="hs-identifier hs-var">txOuts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[TxOut CtxTx Era]] -&gt; [TxOut CtxTx Era]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">([[TxOut CtxTx Era]] -&gt; [TxOut CtxTx Era])
-&gt; ExceptT TxResolutionError m [[TxOut CtxTx Era]]
-&gt; ExceptT TxResolutionError m [TxOut CtxTx Era]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(TxFanConstraint script
 -&gt; ExceptT TxResolutionError m [TxOut CtxTx Era])
-&gt; [TxFanConstraint script]
-&gt; ExceptT TxResolutionError m [[TxOut CtxTx Era]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">TxFanConstraint script
-&gt; ExceptT TxResolutionError m [TxOut CtxTx Era]
</span><a href="#local-6989586621679557631"><span class="hs-identifier hs-var">compileTxConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxFanKind -&gt; [TxFanConstraint script]
</span><a href="#local-6989586621679557620"><span class="hs-identifier hs-var">byKind</span></a></span><span> </span><span class="annot"><span class="annottext">TxFanKind
</span><a href="Cardano.CEM.html#Out"><span class="hs-identifier hs-var">Out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span>      </span><span class="annot"><span class="annottext">ResolvedTx -&gt; ExceptT TxResolutionError m ResolvedTx
forall a. a -&gt; ExceptT TxResolutionError m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(ResolvedTx -&gt; ExceptT TxResolutionError m ResolvedTx)
-&gt; ResolvedTx -&gt; ExceptT TxResolutionError m ResolvedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-209"></span><span>        </span><span class="annot"><a href="Cardano.CEM.Monads.html#MkResolvedTx"><span class="hs-identifier hs-type">MkResolvedTx</span></a></span><span>
</span><span id="line-210"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:txIns:MkResolvedTx :: [(TxIn, TxInWitness)]
</span><a href="Cardano.CEM.Monads.html#%24sel%3AtxIns%3AMkResolvedTx"><span class="hs-identifier hs-var">txIns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxInWitness)]
</span><a href="#local-6989586621679557608"><span class="hs-identifier hs-var">witnesedScriptTxIns</span></a></span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxInWitness)]
-&gt; [(TxIn, TxInWitness)] -&gt; [(TxIn, TxInWitness)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(((TxIn, TxInWitness), TxOut CtxUTxO Era) -&gt; (TxIn, TxInWitness))
-&gt; [((TxIn, TxInWitness), TxOut CtxUTxO Era)]
-&gt; [(TxIn, TxInWitness)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxInWitness), TxOut CtxUTxO Era) -&gt; (TxIn, TxInWitness)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[((TxIn, TxInWitness), TxOut CtxUTxO Era)]
</span><a href="#local-6989586621679557625"><span class="hs-identifier hs-var">txInsPairs</span></a></span><span>
</span><span id="line-211"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:txInsReference:MkResolvedTx :: [TxIn]
</span><a href="Cardano.CEM.Monads.html#%24sel%3AtxInsReference%3AMkResolvedTx"><span class="hs-identifier hs-var">txInsReference</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx Era]
txOuts :: [TxOut CtxTx Era]
$sel:txOuts:MkResolvedTx :: [TxOut CtxTx Era]
</span><a href="#local-6989586621679557630"><span class="hs-identifier hs-var hs-var">txOuts</span></a></span><span>
</span><span id="line-213"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:toMint:MkResolvedTx :: TxMintValue BuildTx Era
</span><a href="Cardano.CEM.Monads.html#%24sel%3AtoMint%3AMkResolvedTx"><span class="hs-identifier hs-var">toMint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx Era
forall build era. TxMintValue build era
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Tx.Body.html#TxMintNone"><span class="hs-identifier hs-var">TxMintNone</span></a></span><span>
</span><span id="line-214"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:additionalSigners:MkResolvedTx :: [PubKeyHash]
</span><a href="Cardano.CEM.Monads.html#%24sel%3AadditionalSigners%3AMkResolvedTx"><span class="hs-identifier hs-var">additionalSigners</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransitionSpec script -&gt; [PubKeyHash]
forall script. TransitionSpec script -&gt; [PubKeyHash]
</span><a href="Cardano.CEM.html#%24sel%3Asigners%3AMkTransitionSpec"><span class="hs-identifier hs-var">signers</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionSpec script
</span><a href="#local-6989586621679557614"><span class="hs-identifier hs-var">scriptTransition</span></a></span><span>
</span><span id="line-215"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:signer:MkResolvedTx :: SigningKey PaymentKey
</span><a href="Cardano.CEM.Monads.html#%24sel%3Asigner%3AMkResolvedTx"><span class="hs-identifier hs-var">signer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SigningKey PaymentKey
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TODO&quot;</span></span><span>
</span><span id="line-216"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:interval:MkResolvedTx :: Interval POSIXTime
</span><a href="Cardano.CEM.Monads.html#%24sel%3Ainterval%3AMkResolvedTx"><span class="hs-identifier hs-var">interval</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Interval POSIXTime
forall a. Interval a
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/plutus-ledger-api-1.21.0.0-1b57f518c9186e0f88796bb5ca61ae8aad79286aaddc760c0b547f08904e829b/share/doc/html/src/PlutusLedgerApi.V1.Interval.html#always"><span class="hs-identifier hs-var">always</span></a></span><span>
</span><span id="line-217"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-219"></span><span>      </span><span id="local-6989586621679557613"><span class="annot"><span class="annottext">script :: ShortByteString
</span><a href="#local-6989586621679557613"><span class="hs-identifier hs-var hs-var">script</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy script -&gt; ShortByteString
forall script.
CEMScriptCompiled script =&gt;
Proxy script -&gt; ShortByteString
</span><a href="Cardano.CEM.OnChain.html#cemScriptCompiled"><span class="hs-identifier hs-var">cemScriptCompiled</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy script
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679557599"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>      </span><span id="local-6989586621679557646"><span class="annot"><span class="annottext">scriptAddress :: Address
</span><a href="#local-6989586621679557646"><span class="hs-identifier hs-var hs-var">scriptAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy script -&gt; Address
forall script. CEMScriptCompiled script =&gt; Proxy script -&gt; Address
</span><a href="Cardano.CEM.OnChain.html#cemScriptAddress"><span class="hs-identifier hs-var">cemScriptAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy script
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="#local-6989586621679557599"><span class="hs-identifier hs-type">script</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>      </span><span id="local-6989586621679557628"><span class="annot"><span class="annottext">resolveTxIn :: TxFanConstraint script
-&gt; ExceptT
     TxResolutionError m [((TxIn, TxInWitness), TxOut CtxUTxO Era)]
</span><a href="#local-6989586621679557628"><span class="hs-identifier hs-var hs-var">resolveTxIn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#MkTxFanC"><span class="hs-identifier hs-type">MkTxFanC</span></a></span><span> </span><span class="annot"><span class="annottext">TxFanKind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#MkTxFanFilter"><span class="hs-identifier hs-type">MkTxFanFilter</span></a></span><span> </span><span id="local-6989586621679557649"><span class="annot"><span class="annottext">AddressSpec
</span><a href="#local-6989586621679557649"><span class="hs-identifier hs-var">addressSpec</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxFanFilter' script
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Quantor
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>        </span><span id="local-6989586621679557650"><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679557650"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (UTxO Era) -&gt; ExceptT TxResolutionError m (UTxO Era)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT TxResolutionError m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (UTxO Era) -&gt; ExceptT TxResolutionError m (UTxO Era))
-&gt; m (UTxO Era) -&gt; ExceptT TxResolutionError m (UTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UtxoQuery -&gt; m (UTxO Era)
forall (m :: * -&gt; *). MonadQueryUtxo m =&gt; UtxoQuery -&gt; m (UTxO Era)
</span><a href="Cardano.CEM.Monads.html#queryUtxo"><span class="hs-identifier hs-var">queryUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">(UtxoQuery -&gt; m (UTxO Era)) -&gt; UtxoQuery -&gt; m (UTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Address] -&gt; UtxoQuery
</span><a href="Cardano.CEM.Monads.html#ByAddresses"><span class="hs-identifier hs-var">ByAddresses</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679557651"><span class="hs-identifier hs-var">address</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span>        </span><span class="annot"><span class="annottext">[((TxIn, TxInWitness), TxOut CtxUTxO Era)]
-&gt; ExceptT
     TxResolutionError m [((TxIn, TxInWitness), TxOut CtxUTxO Era)]
forall a. a -&gt; ExceptT TxResolutionError m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([((TxIn, TxInWitness), TxOut CtxUTxO Era)]
 -&gt; ExceptT
      TxResolutionError m [((TxIn, TxInWitness), TxOut CtxUTxO Era)])
-&gt; [((TxIn, TxInWitness), TxOut CtxUTxO Era)]
-&gt; ExceptT
     TxResolutionError m [((TxIn, TxInWitness), TxOut CtxUTxO Era)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO Era)
 -&gt; ((TxIn, TxInWitness), TxOut CtxUTxO Era))
-&gt; [(TxIn, TxOut CtxUTxO Era)]
-&gt; [((TxIn, TxInWitness), TxOut CtxUTxO Era)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679557652"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679557652"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679557653"><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679557653"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; (TxIn, TxInWitness)
</span><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#withKeyWitness"><span class="hs-identifier hs-var">withKeyWitness</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679557652"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut CtxUTxO Era
</span><a href="#local-6989586621679557653"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(TxIn, TxOut CtxUTxO Era)]
 -&gt; [((TxIn, TxInWitness), TxOut CtxUTxO Era)])
-&gt; [(TxIn, TxOut CtxUTxO Era)]
-&gt; [((TxIn, TxInWitness), TxOut CtxUTxO Era)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO Era) -&gt; [(TxIn, TxOut CtxUTxO Era)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map TxIn (TxOut CtxUTxO Era) -&gt; [(TxIn, TxOut CtxUTxO Era)])
-&gt; Map TxIn (TxOut CtxUTxO Era) -&gt; [(TxIn, TxOut CtxUTxO Era)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UTxO Era -&gt; Map TxIn (TxOut CtxUTxO Era)
forall era. UTxO era -&gt; Map TxIn (TxOut CtxUTxO era)
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Query.html#unUTxO"><span class="hs-identifier hs-var">unUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679557650"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-225"></span><span>          </span><span id="local-6989586621679557651"><span class="annot"><span class="annottext">address :: Address
</span><a href="#local-6989586621679557651"><span class="hs-identifier hs-var hs-var">address</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address -&gt; AddressSpec -&gt; Address
</span><a href="Cardano.CEM.html#addressSpecToAddress"><span class="hs-identifier hs-var">addressSpecToAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679557646"><span class="hs-identifier hs-var">scriptAddress</span></a></span><span> </span><span class="annot"><span class="annottext">AddressSpec
</span><a href="#local-6989586621679557649"><span class="hs-identifier hs-var">addressSpec</span></a></span><span>
</span><span id="line-226"></span><span>      </span><span id="local-6989586621679557631"><span class="annot"><span class="annottext">compileTxConstraint :: TxFanConstraint script
-&gt; ExceptT TxResolutionError m [TxOut CtxTx Era]
</span><a href="#local-6989586621679557631"><span class="hs-identifier hs-var hs-var">compileTxConstraint</span></a></span></span><span>
</span><span id="line-227"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#MkTxFanC"><span class="hs-identifier hs-type">MkTxFanC</span></a></span><span> </span><span class="annot"><span class="annottext">TxFanKind
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.html#MkTxFanFilter"><span class="hs-identifier hs-type">MkTxFanFilter</span></a></span><span> </span><span id="local-6989586621679557657"><span class="annot"><span class="annottext">AddressSpec
</span><a href="#local-6989586621679557657"><span class="hs-identifier hs-var">addressSpec</span></a></span></span><span> </span><span id="local-6989586621679557658"><span class="annot"><span class="annottext">TxFanFilter' script
</span><a href="#local-6989586621679557658"><span class="hs-identifier hs-var">filterSpec</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679557659"><span class="annot"><span class="annottext">Quantor
</span><a href="#local-6989586621679557659"><span class="hs-identifier hs-var">quantor</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-228"></span><span>          </span><span id="local-6989586621679557660"><span class="annot"><span class="annottext">AddressInEra Era
</span><a href="#local-6989586621679557660"><span class="hs-identifier hs-var">address'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (AddressInEra Era)
-&gt; ExceptT TxResolutionError m (AddressInEra Era)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT TxResolutionError m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (AddressInEra Era)
 -&gt; ExceptT TxResolutionError m (AddressInEra Era))
-&gt; m (AddressInEra Era)
-&gt; ExceptT TxResolutionError m (AddressInEra Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Address -&gt; m (AddressInEra Era)
forall (m :: * -&gt; *).
MonadBlockchainParams m =&gt;
Address -&gt; m (AddressInEra Era)
</span><a href="Cardano.CEM.OffChain.html#fromPlutusAddressInMonad"><span class="hs-identifier hs-var">fromPlutusAddressInMonad</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679557661"><span class="hs-identifier hs-var">address</span></a></span><span>
</span><span id="line-229"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679557662"><span class="annot"><span class="annottext">compiledTxOut :: TxOutValue Era -&gt; TxOut CtxTx Era
</span><a href="#local-6989586621679557662"><span class="hs-identifier hs-var hs-var">compiledTxOut</span></a></span></span><span> </span><span id="local-6989586621679557663"><span class="annot"><span class="annottext">TxOutValue Era
</span><a href="#local-6989586621679557663"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-230"></span><span>                </span><span class="annot"><span class="annottext">AddressInEra Era
-&gt; TxOutValue Era
-&gt; TxOutDatum CtxTx Era
-&gt; ReferenceScript Era
-&gt; TxOut CtxTx Era
forall ctx era.
AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum ctx era
-&gt; ReferenceScript era
-&gt; TxOut ctx era
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Tx.Body.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra Era
</span><a href="#local-6989586621679557660"><span class="hs-identifier hs-var">address'</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue Era
</span><a href="#local-6989586621679557663"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx Era
</span><a href="#local-6989586621679557665"><span class="hs-identifier hs-var">datum</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript Era
forall era. ReferenceScript era
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Script.html#ReferenceScriptNone"><span class="hs-identifier hs-var">ReferenceScriptNone</span></a></span><span>
</span><span id="line-231"></span><span>          </span><span class="annot"><span class="annottext">[TxOut CtxTx Era] -&gt; ExceptT TxResolutionError m [TxOut CtxTx Era]
forall a. a -&gt; ExceptT TxResolutionError m a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">([TxOut CtxTx Era]
 -&gt; ExceptT TxResolutionError m [TxOut CtxTx Era])
-&gt; [TxOut CtxTx Era]
-&gt; ExceptT TxResolutionError m [TxOut CtxTx Era]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Quantor
</span><a href="#local-6989586621679557659"><span class="hs-identifier hs-var">quantor</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-232"></span><span>            </span><span class="annot"><a href="Cardano.CEM.html#Exist"><span class="hs-identifier hs-type">Exist</span></a></span><span> </span><span id="local-6989586621679557668"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679557668"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; TxOut CtxTx Era -&gt; [TxOut CtxTx Era]
forall a. Int -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">replicate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Int
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679557668"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxOut CtxTx Era -&gt; [TxOut CtxTx Era])
-&gt; TxOut CtxTx Era -&gt; [TxOut CtxTx Era]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxOutValue Era -&gt; TxOut CtxTx Era
</span><a href="#local-6989586621679557662"><span class="hs-identifier hs-var">compiledTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutValue Era
</span><a href="#local-6989586621679557670"><span class="hs-identifier hs-var">minUtxoValue</span></a></span><span>
</span><span id="line-233"></span><span>            </span><span class="annot"><a href="Cardano.CEM.html#SumValueEq"><span class="hs-identifier hs-type">SumValueEq</span></a></span><span> </span><span id="local-6989586621679557672"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679557672"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxOutValue Era -&gt; TxOut CtxTx Era
</span><a href="#local-6989586621679557662"><span class="hs-identifier hs-var">compiledTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOutValue Era -&gt; TxOut CtxTx Era)
-&gt; TxOutValue Era -&gt; TxOut CtxTx Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; TxOutValue Era
forall {era}.
(Value (ShelleyLedgerEra era) ~ MaryValue StandardCrypto,
 IsShelleyBasedEra era) =&gt;
Value -&gt; TxOutValue era
</span><a href="#local-6989586621679557673"><span class="hs-identifier hs-var">convertTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; TxOutValue Era) -&gt; Value -&gt; TxOutValue Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#fromPlutusValue"><span class="hs-identifier hs-var">fromPlutusValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679557672"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOutValue Era -&gt; TxOutValue Era -&gt; TxOutValue Era
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxOutValue Era
</span><a href="#local-6989586621679557670"><span class="hs-identifier hs-var">minUtxoValue</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-234"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-235"></span><span>            </span><span id="local-6989586621679557665"><span class="annot"><span class="annottext">datum :: TxOutDatum CtxTx Era
</span><a href="#local-6989586621679557665"><span class="hs-identifier hs-var hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxFanFilter' script
</span><a href="#local-6989586621679557658"><span class="hs-identifier hs-var">filterSpec</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-236"></span><span>              </span><span class="annot"><span class="annottext">TxFanFilter' script
</span><a href="Cardano.CEM.html#Anything"><span class="hs-identifier hs-var">Anything</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx Era
forall ctx era. TxOutDatum ctx era
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Tx.Body.html#TxOutDatumNone"><span class="hs-identifier hs-var">TxOutDatumNone</span></a></span><span>
</span><span id="line-237"></span><span>              </span><span class="annot"><a href="Cardano.CEM.html#ByDatum"><span class="hs-identifier hs-type">ByDatum</span></a></span><span> </span><span id="local-6989586621679557678"><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621679557678"><span class="hs-identifier hs-var">datum'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; TxOutDatum CtxTx Era
forall datum ctx. ToData datum =&gt; datum -&gt; TxOutDatum ctx Era
</span><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#mkInlineDatum"><span class="hs-identifier hs-var">mkInlineDatum</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621679557678"><span class="hs-identifier hs-var">datum'</span></a></span><span>
</span><span id="line-238"></span><span>              </span><span class="hs-comment">-- FIXME: Can be optimized via Plutarch</span><span>
</span><span id="line-239"></span><span>              </span><span class="annot"><a href="Cardano.CEM.html#UnsafeBySameCEM"><span class="hs-identifier hs-type">UnsafeBySameCEM</span></a></span><span> </span><span id="local-6989586621679557681"><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621679557681"><span class="hs-identifier hs-var">newState</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-240"></span><span>                </span><span class="hs-keyword">let</span><span>
</span><span id="line-241"></span><span>                  </span><span class="annot"><a href="#local-6989586621679557682"><span class="hs-identifier hs-type">cemDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.CEM.html#CEMScriptDatum"><span class="hs-identifier hs-type">CEMScriptDatum</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557599"><span class="hs-identifier hs-type">script</span></a></span><span>
</span><span id="line-242"></span><span>                  </span><span id="local-6989586621679557682"><span class="annot"><span class="annottext">cemDatum :: (StageParams (Stage script), Params script, State script)
</span><a href="#local-6989586621679557682"><span class="hs-identifier hs-var hs-var">cemDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CEMParams script -&gt; StageParams (Stage script)
forall script. CEMParams script -&gt; StageParams (Stage script)
</span><a href="Cardano.CEM.html#%24sel%3AstagesParams%3AMkCEMParams"><span class="hs-identifier hs-var">stagesParams</span></a></span><span> </span><span class="annot"><span class="annottext">CEMParams script
</span><a href="#local-6989586621679557600"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-244"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CEMParams script -&gt; Params script
forall script. CEMParams script -&gt; Params script
</span><a href="Cardano.CEM.html#%24sel%3AscriptParams%3AMkCEMParams"><span class="hs-identifier hs-var">scriptParams</span></a></span><span> </span><span class="annot"><span class="annottext">CEMParams script
</span><a href="#local-6989586621679557600"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-245"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; State script
forall a. UnsafeFromData a =&gt; BuiltinData -&gt; a
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/plutus-tx-1.21.0.0-3d2b6b90b431fd10c385af250c9cbf5353d9dd2c7b595a24bf8345c705ac5ca0/share/doc/html/src/PlutusTx.IsData.Class.html#unsafeFromBuiltinData"><span class="hs-identifier hs-var">unsafeFromBuiltinData</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltinData
</span><a href="#local-6989586621679557681"><span class="hs-identifier hs-var">newState</span></a></span><span>
</span><span id="line-246"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>                 </span><span class="hs-keyword">in</span><span>
</span><span id="line-248"></span><span>                  </span><span class="annot"><span class="annottext">(StageParams (Stage script), Params script, State script)
-&gt; TxOutDatum CtxTx Era
forall datum ctx. ToData datum =&gt; datum -&gt; TxOutDatum ctx Era
</span><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#mkInlineDatum"><span class="hs-identifier hs-var">mkInlineDatum</span></a></span><span> </span><span class="annot"><span class="annottext">(StageParams (Stage script), Params script, State script)
</span><a href="#local-6989586621679557682"><span class="hs-identifier hs-var">cemDatum</span></a></span><span>
</span><span id="line-249"></span><span>            </span><span id="local-6989586621679557661"><span class="annot"><span class="annottext">address :: Address
</span><a href="#local-6989586621679557661"><span class="hs-identifier hs-var hs-var">address</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address -&gt; AddressSpec -&gt; Address
</span><a href="Cardano.CEM.html#addressSpecToAddress"><span class="hs-identifier hs-var">addressSpecToAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679557646"><span class="hs-identifier hs-var">scriptAddress</span></a></span><span> </span><span class="annot"><span class="annottext">AddressSpec
</span><a href="#local-6989586621679557657"><span class="hs-identifier hs-var">addressSpec</span></a></span><span>
</span><span id="line-250"></span><span>            </span><span class="hs-comment">-- TODO: protocol params</span><span>
</span><span id="line-251"></span><span>            </span><span class="hs-comment">-- calculateMinimumUTxO era txout bpp</span><span>
</span><span id="line-252"></span><span>            </span><span id="local-6989586621679557670"><span class="annot"><span class="annottext">minUtxoValue :: TxOutValue Era
</span><a href="#local-6989586621679557670"><span class="hs-identifier hs-var hs-var">minUtxoValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; TxOutValue Era
forall {era}.
(Value (ShelleyLedgerEra era) ~ MaryValue StandardCrypto,
 IsShelleyBasedEra era) =&gt;
Value -&gt; TxOutValue era
</span><a href="#local-6989586621679557673"><span class="hs-identifier hs-var">convertTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; TxOutValue Era) -&gt; Value -&gt; TxOutValue Era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Lovelace -&gt; Value
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Value.html#lovelaceToValue"><span class="hs-identifier hs-var">lovelaceToValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Lovelace -&gt; Value) -&gt; Lovelace -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Lovelace
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Value.html#Lovelace"><span class="hs-identifier hs-var">Lovelace</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">3_000_000</span></span><span>
</span><span id="line-253"></span><span>            </span><span class="hs-comment">-- TODO</span><span>
</span><span id="line-254"></span><span>            </span><span id="local-6989586621679557673"><span class="annot"><span class="annottext">convertTxOut :: Value -&gt; TxOutValue era
</span><a href="#local-6989586621679557673"><span class="hs-identifier hs-var hs-var">convertTxOut</span></a></span></span><span> </span><span id="local-6989586621679557715"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679557715"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>              </span><span class="annot"><span class="annottext">ShelleyBasedEra era
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
forall era.
(Eq (Value (ShelleyLedgerEra era)),
 Show (Value (ShelleyLedgerEra era))) =&gt;
ShelleyBasedEra era
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Tx.Body.html#TxOutValueShelleyBased"><span class="hs-identifier hs-var">TxOutValueShelleyBased</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra era
forall era. IsShelleyBasedEra era =&gt; ShelleyBasedEra era
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Eon.ShelleyBasedEra.html#shelleyBasedEra"><span class="hs-identifier hs-var">shelleyBasedEra</span></a></span><span> </span><span class="annot"><span class="annottext">(Value (ShelleyLedgerEra era) -&gt; TxOutValue era)
-&gt; Value (ShelleyLedgerEra era) -&gt; TxOutValue era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; MaryValue StandardCrypto
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Value.html#toMaryValue"><span class="hs-identifier hs-var">toMaryValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679557715"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span id="local-6989586621679557229"><span class="annot"><a href="Cardano.CEM.OffChain.html#resolveTxAndSubmit"><span class="hs-identifier hs-type">resolveTxAndSubmit</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.CEM.Monads.html#MonadQueryUtxo"><span class="hs-identifier hs-type">MonadQueryUtxo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557229"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.CEM.Monads.html#MonadSubmitTx"><span class="hs-identifier hs-type">MonadSubmitTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557229"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679557229"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><a href="Cardano.CEM.OffChain.html#TxSpec"><span class="hs-identifier hs-type">TxSpec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><a href="#local-6989586621679557229"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Cardano.CEM.OffChain.html#TxResolutionError"><span class="hs-identifier hs-type">TxResolutionError</span></a></span><span> </span><span class="annot"><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.TxIn.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-261"></span><span id="resolveTxAndSubmit"><span class="annot"><span class="annottext">resolveTxAndSubmit :: forall (m :: * -&gt; *).
(MonadQueryUtxo m, MonadSubmitTx m, MonadIO m) =&gt;
TxSpec -&gt; m (Either TxResolutionError TxId)
</span><a href="Cardano.CEM.OffChain.html#resolveTxAndSubmit"><span class="hs-identifier hs-var hs-var">resolveTxAndSubmit</span></a></span></span><span> </span><span id="local-6989586621679557740"><span class="annot"><span class="annottext">TxSpec
</span><a href="#local-6989586621679557740"><span class="hs-identifier hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT TxResolutionError m TxId
-&gt; m (Either TxResolutionError TxId)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT TxResolutionError m TxId
 -&gt; m (Either TxResolutionError TxId))
-&gt; ExceptT TxResolutionError m TxId
-&gt; m (Either TxResolutionError TxId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-comment">-- Get specs</span><span>
</span><span id="line-263"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621679557741"><span class="annot"><span class="annottext">[ResolvedTx]
</span><a href="#local-6989586621679557741"><span class="hs-identifier hs-var">actionsSpecs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SomeCEMAction -&gt; ExceptT TxResolutionError m ResolvedTx)
-&gt; [SomeCEMAction] -&gt; ExceptT TxResolutionError m [ResolvedTx]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m (Either TxResolutionError ResolvedTx)
-&gt; ExceptT TxResolutionError m ResolvedTx
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">ExceptT</span></span><span> </span><span class="annot"><span class="annottext">(m (Either TxResolutionError ResolvedTx)
 -&gt; ExceptT TxResolutionError m ResolvedTx)
-&gt; (SomeCEMAction -&gt; m (Either TxResolutionError ResolvedTx))
-&gt; SomeCEMAction
-&gt; ExceptT TxResolutionError m ResolvedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SomeCEMAction -&gt; m (Either TxResolutionError ResolvedTx)
forall (m :: * -&gt; *).
(MonadQueryUtxo m, MonadSubmitTx m) =&gt;
SomeCEMAction -&gt; m (Either TxResolutionError ResolvedTx)
</span><a href="Cardano.CEM.OffChain.html#resolveAction"><span class="hs-identifier hs-var">resolveAction</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SomeCEMAction] -&gt; ExceptT TxResolutionError m [ResolvedTx])
-&gt; [SomeCEMAction] -&gt; ExceptT TxResolutionError m [ResolvedTx]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxSpec -&gt; [SomeCEMAction]
</span><a href="Cardano.CEM.OffChain.html#%24sel%3Aactions%3AMkTxSpec"><span class="hs-identifier hs-var">actions</span></a></span><span> </span><span class="annot"><span class="annottext">TxSpec
</span><a href="#local-6989586621679557740"><span class="hs-identifier hs-var">spec</span></a></span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-comment">-- Merge specs</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621679557743"><span class="annot"><span class="annottext">mergedSpec' :: ResolvedTx
</span><a href="#local-6989586621679557743"><span class="hs-identifier hs-var hs-var">mergedSpec'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ResolvedTx] -&gt; ResolvedTx
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[ResolvedTx]
</span><a href="#local-6989586621679557741"><span class="hs-identifier hs-var">actionsSpecs</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span id="local-6989586621679557745"><span class="annot"><span class="annottext">mergedSpec :: ResolvedTx
</span><a href="#local-6989586621679557745"><span class="hs-identifier hs-var hs-var">mergedSpec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResolvedTx
</span><a href="#local-6989586621679557743"><span class="hs-identifier hs-var">mergedSpec'</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.CEM.Monads.html#%24sel%3Asigner%3AMkResolvedTx"><span class="hs-identifier hs-var">signer</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.CEM.OffChain.html#%24sel%3AspecSigner%3AMkTxSpec"><span class="hs-identifier hs-var">specSigner</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557740"><span class="hs-identifier hs-type">spec</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-comment">-- FIXME: more robust fee covering</span><span>
</span><span id="line-271"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621679557746"><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679557746"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><span class="annottext">m (UTxO Era) -&gt; ExceptT TxResolutionError m (UTxO Era)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a -&gt; ExceptT TxResolutionError m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(m (UTxO Era) -&gt; ExceptT TxResolutionError m (UTxO Era))
-&gt; m (UTxO Era) -&gt; ExceptT TxResolutionError m (UTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UtxoQuery -&gt; m (UTxO Era)
forall (m :: * -&gt; *). MonadQueryUtxo m =&gt; UtxoQuery -&gt; m (UTxO Era)
</span><a href="Cardano.CEM.Monads.html#queryUtxo"><span class="hs-identifier hs-var">queryUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">(UtxoQuery -&gt; m (UTxO Era)) -&gt; UtxoQuery -&gt; m (UTxO Era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Address] -&gt; UtxoQuery
</span><a href="Cardano.CEM.Monads.html#ByAddresses"><span class="hs-identifier hs-var">ByAddresses</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SigningKey PaymentKey -&gt; Address
</span><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#signingKeyToAddress"><span class="hs-identifier hs-var">signingKeyToAddress</span></a></span><span> </span><span class="annot"><span class="annottext">(SigningKey PaymentKey -&gt; Address)
-&gt; SigningKey PaymentKey -&gt; Address
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResolvedTx -&gt; SigningKey PaymentKey
</span><a href="Cardano.CEM.Monads.html#%24sel%3Asigner%3AMkResolvedTx"><span class="hs-identifier hs-var">signer</span></a></span><span> </span><span class="annot"><span class="annottext">ResolvedTx
</span><a href="#local-6989586621679557745"><span class="hs-identifier hs-var">mergedSpec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679557748"><span class="annot"><span class="annottext">ins :: [(TxIn, TxInWitness)]
</span><a href="#local-6989586621679557748"><span class="hs-identifier hs-var hs-var">ins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; (TxIn, TxInWitness)) -&gt; [TxIn] -&gt; [(TxIn, TxInWitness)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; (TxIn, TxInWitness)
</span><a href="file:///home/gregory/Programming/cem-script/dist-newstyle/build/x86_64-linux/ghc-9.6.3/cem-script-0.1.0/l/cardano-extras/doc/html/cem-script/src/Cardano.Extras.html#withKeyWitness"><span class="hs-identifier hs-var">withKeyWitness</span></a></span><span> </span><span class="annot"><span class="annottext">([TxIn] -&gt; [(TxIn, TxInWitness)])
-&gt; [TxIn] -&gt; [(TxIn, TxInWitness)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO Era) -&gt; [TxIn]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">(Map TxIn (TxOut CtxUTxO Era) -&gt; [TxIn])
-&gt; Map TxIn (TxOut CtxUTxO Era) -&gt; [TxIn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UTxO Era -&gt; Map TxIn (TxOut CtxUTxO Era)
forall era. UTxO era -&gt; Map TxIn (TxOut CtxUTxO era)
</span><a href="file:///home/gregory/.cabal/store/ghc-9.6.3/cardano-api-8.38.0.0-l-internal-31ab96ab6aea6df2f00a941c7882e1845dd1479d00b8c3ab8f8e2677843a00e7/share/doc/html/src/Cardano.Api.Query.html#unUTxO"><span class="hs-identifier hs-var">unUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO Era
</span><a href="#local-6989586621679557746"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-274"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679557750"><span class="annot"><span class="annottext">result :: m (Either TxSubmittingError TxId)
</span><a href="#local-6989586621679557750"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ResolvedTx -&gt; m (Either TxSubmittingError TxId)
forall (m :: * -&gt; *).
MonadSubmitTx m =&gt;
ResolvedTx -&gt; m (Either TxSubmittingError TxId)
</span><a href="Cardano.CEM.Monads.html#submitResolvedTx"><span class="hs-identifier hs-var">submitResolvedTx</span></a></span><span> </span><span class="annot"><span class="annottext">(ResolvedTx -&gt; m (Either TxSubmittingError TxId))
-&gt; ResolvedTx -&gt; m (Either TxSubmittingError TxId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ResolvedTx
</span><a href="#local-6989586621679557745"><span class="hs-identifier hs-var">mergedSpec</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.CEM.Monads.html#%24sel%3AtxIns%3AMkResolvedTx"><span class="hs-identifier hs-var">txIns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.CEM.Monads.html#%24sel%3AtxIns%3AMkResolvedTx"><span class="hs-identifier hs-var">txIns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679557745"><span class="hs-identifier hs-type">mergedSpec</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">++</span></span><span> </span><span class="annot"><a href="#local-6989586621679557748"><span class="hs-identifier hs-type">ins</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><span class="annottext">m (Either TxResolutionError TxId)
-&gt; ExceptT TxResolutionError m TxId
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><span class="hs-identifier hs-var">ExceptT</span></span><span> </span><span class="annot"><span class="annottext">(m (Either TxResolutionError TxId)
 -&gt; ExceptT TxResolutionError m TxId)
-&gt; m (Either TxResolutionError TxId)
-&gt; ExceptT TxResolutionError m TxId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxSubmittingError -&gt; TxResolutionError)
-&gt; (TxId -&gt; TxId)
-&gt; Either TxSubmittingError TxId
-&gt; Either TxResolutionError TxId
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; Either a c -&gt; Either b d
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">TxSubmittingError -&gt; TxResolutionError
</span><a href="Cardano.CEM.OffChain.html#UnhandledSubmittingError"><span class="hs-identifier hs-var">UnhandledSubmittingError</span></a></span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxId
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either TxSubmittingError TxId -&gt; Either TxResolutionError TxId)
-&gt; m (Either TxSubmittingError TxId)
-&gt; m (Either TxResolutionError TxId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (Either TxSubmittingError TxId)
</span><a href="#local-6989586621679557750"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-276"></span></pre></body></html>